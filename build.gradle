plugins {
    id 'dev.watheia.node-conventions'
    id 'dev.watheia.docker-conventions'
    id 'dev.watheia.docker-compose-conventions'
}

docker {
    copySpec.from(projectDir) {
        include 'lerna.json'
        include 'package.json'
        include 'yarn.lock'
        include 'browser-app/package.json'
        include 'runtime-workspace/**'
        include 'theia-auth-extension/package.json'
        include 'theia-auth-extension/package.json'
        include 'theia-auth-extension/tsconfig.json'
        include 'theia-auth-extension/src/**'
    }
}

assemble {
    dependsOn ':theia-server:docker-backend:assemble',
            ':theia-server:gatekeeper:assemble'
}

tasks.docker.mustRunAfter ':theia-server:docker-backend:assemble'